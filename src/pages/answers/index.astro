---
/**
 * Answers Index Page
 *
 * Quick answers to common law firm marketing questions.
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all published answers
const allAnswers = await getCollection('answers', ({ data }) => !data.draft);

// Sort by date, newest first
const sortedAnswers = allAnswers.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Group answers by cluster
const answersByCluster = sortedAnswers.reduce(
  (acc, answer) => {
    const cluster = answer.data.cluster;
    if (!acc[cluster]) {
      acc[cluster] = [];
    }
    acc[cluster].push(answer);
    return acc;
  },
  {} as Record<string, typeof sortedAnswers>
);

// Cluster labels
const clusterLabels: Record<string, { label: string }> = {
  'fractional-cmo': { label: 'Fractional CMO' },
  'law-firm-marketing': { label: 'Law Firm Marketing' },
  seo: { label: 'SEO' },
  ppc: { label: 'PPC and Paid Ads' },
  'lead-gen': { label: 'Lead Generation' },
  budget: { label: 'Marketing Budget' },
};

// Helper to format date
function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<BaseLayout
  title="Law Firm Marketing Answers"
  description="Quick answers to common law firm marketing questions. Fractional CMO, SEO, PPC, lead generation, and budget topics explained."
  image="/og/answers.png"
>
  <!-- Hero Section -->
  <section class="answers-hero">
    <div class="container">
      <div class="hero-content">
        <span class="section-label">Quick Answers</span>
        <h1 class="hero-title">Your Marketing Questions, Answered</h1>
        <p class="hero-subtitle">
          Get quick, expert answers to common law firm marketing questions. Each
          answer is written by Keith Dyer with 15+ years of legal marketing
          experience.
        </p>
        <div class="search-box">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="M21 21l-4.35-4.35"></path>
          </svg>
          <input
            type="text"
            placeholder="Search answers..."
            id="search-input"
            autocomplete="off"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- All Answers Section -->
  <section class="answers-section">
    <div class="container">
      <div class="answers-layout">
        <!-- Sidebar with clusters -->
        <aside class="answers-sidebar">
          <h2 class="sidebar-title">Topics</h2>
          <nav class="topic-nav">
            <a href="#all" class="topic-link active"> All Questions </a>
            {
              Object.entries(answersByCluster).map(([cluster, answers]) => (
                <a href={`#${cluster}`} class="topic-link">
                  {clusterLabels[cluster]?.label || cluster}
                  <span class="topic-count">{answers.length}</span>
                </a>
              ))
            }
          </nav>
        </aside>

        <!-- Main content -->
        <div class="answers-main" id="all">
          <div class="answers-header">
            <h2 class="answers-title">
              All Questions <span class="answer-count"
                >({sortedAnswers.length})</span
              >
            </h2>
          </div>

          <div class="answers-list" id="answers-list">
            {
              sortedAnswers.map((answer) => (
                <a
                  href={`/answers/${answer.data.slug}/`}
                  class="answer-card"
                  data-cluster={answer.data.cluster}
                  data-title={answer.data.title.toLowerCase()}
                  data-description={answer.data.description.toLowerCase()}
                >
                  <div class="answer-card-header">
                    <span class="answer-cluster">
                      {clusterLabels[answer.data.cluster]?.label ||
                        answer.data.cluster}
                    </span>
                    <span class="answer-reading-time">
                      {answer.data.wordCount
                        ? `${Math.ceil(answer.data.wordCount / 200)} min`
                        : '5 min'}
                    </span>
                  </div>
                  <h3 class="answer-title">{answer.data.title}</h3>
                  <p class="answer-quick">{answer.data.quickAnswer}</p>
                  <div class="answer-footer">
                    <span class="answer-date">
                      {formatDate(answer.data.pubDate)}
                    </span>
                    <span class="answer-cta">
                      Read Full Answer
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M5 12h14M12 5l7 7-7 7" />
                      </svg>
                    </span>
                  </div>
                </a>
              ))
            }
          </div>

          <!-- No results message -->
          <div class="no-results" id="no-results" style="display: none;">
            <div class="no-results-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
              </svg>
            </div>
            <h3>No answers found</h3>
            <p>Try adjusting your search or browse all topics.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Popular Questions Section -->
  <section class="popular-section">
    <div class="container">
      <div class="section-header">
        <span class="section-label">Most Asked</span>
        <h2 class="section-title">Popular Questions</h2>
      </div>

      <div class="popular-grid">
        <a href="/answers/what-is-fractional-cmo/" class="popular-card">
          <span class="popular-number">01</span>
          <h3 class="popular-title">What is a fractional CMO?</h3>
          <p class="popular-text">
            A part-time Chief Marketing Officer who provides senior-level
            strategy without full-time costs.
          </p>
        </a>

        <div class="popular-card popular-card-coming">
          <span class="popular-number">02</span>
          <h3 class="popular-title">How much does a fractional CMO cost?</h3>
          <p class="popular-text">
            Typically $3,000-$15,000/month, a fraction of a full-time CMO's
            $200K+ salary.
          </p>
          <span class="coming-badge">Coming Soon</span>
        </div>

        <div class="popular-card popular-card-coming">
          <span class="popular-number">03</span>
          <h3 class="popular-title">Fractional CMO vs. marketing agency?</h3>
          <p class="popular-text">
            A CMO provides strategy and accountability; agencies execute
            tactics.
          </p>
          <span class="coming-badge">Coming Soon</span>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2 class="cta-title">Have a Question We Haven't Answered?</h2>
        <p class="cta-subtitle">
          We're always adding new content. Reach out and your question might
          become our next answer.
        </p>
        <div class="cta-buttons">
          <a href="/contact/" class="btn btn-primary btn-lg">
            Ask Your Question
          </a>
          <a href="/guide/" class="btn btn-secondary btn-lg">
            Browse Our Guides
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Simple search functionality
  const searchInput = document.getElementById(
    'search-input'
  ) as HTMLInputElement;
  const answersList = document.getElementById('answers-list');
  const noResults = document.getElementById('no-results');
  const answerCards = document.querySelectorAll('.answer-card');

  if (searchInput && answersList && noResults) {
    searchInput.addEventListener('input', (e) => {
      const query = (e.target as HTMLInputElement).value.toLowerCase().trim();
      let visibleCount = 0;

      answerCards.forEach((card) => {
        const title = card.getAttribute('data-title') || '';
        const description = card.getAttribute('data-description') || '';

        if (
          query === '' ||
          title.includes(query) ||
          description.includes(query)
        ) {
          (card as HTMLElement).style.display = '';
          visibleCount++;
        } else {
          (card as HTMLElement).style.display = 'none';
        }
      });

      noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    });
  }
</script>

<style>
  /* Hero Section */
  .answers-hero {
    padding: 5rem 0 3rem;
    background: var(--color-bg-dark);
    color: #fff;
    text-align: center;
  }

  .hero-content {
    max-width: 600px;
    margin: 0 auto;
  }

  .section-label {
    color: var(--color-primary-light);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.75rem;
    display: block;
  }

  .hero-title {
    font-size: clamp(2rem, 5vw, 2.75rem);
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 1.25rem;
    color: #fff;
  }

  .hero-subtitle {
    font-size: 1.0625rem;
    color: #b0b8b3;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .search-box {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    max-width: 400px;
    margin: 0 auto;
    padding: 0.875rem 1.25rem;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: 100px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }

  .search-box svg {
    color: #4b5563;
    flex-shrink: 0;
  }

  .search-box input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 1rem;
    color: var(--color-text-dark);
    background: transparent;
  }

  .search-box input::placeholder {
    color: #4b5563;
  }

  /* Answers Section */
  .answers-section {
    padding: 3rem 0 5rem;
    background: white;
  }

  .answers-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  @media (min-width: 900px) {
    .answers-layout {
      grid-template-columns: 220px 1fr;
      gap: 3rem;
    }
  }

  /* Sidebar */
  .answers-sidebar {
    position: sticky;
    top: 100px;
    height: fit-content;
  }

  @media (max-width: 899px) {
    .answers-sidebar {
      position: static;
    }
  }

  .sidebar-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #4b5563;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1rem;
  }

  .topic-nav {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  @media (max-width: 899px) {
    .topic-nav {
      flex-direction: row;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
  }

  .topic-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.875rem;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.9375rem;
    color: var(--color-text-dark);
    transition: all 0.2s ease;
  }

  .topic-link:hover {
    background: #fafafa;
  }

  .topic-link.active {
    background: var(--color-primary);
    color: white;
  }

  .topic-icon {
    font-size: 1rem;
  }

  .topic-count {
    margin-left: auto;
    font-size: 0.75rem;
    color: #4b5563;
    background: #fafafa;
    padding: 0.125rem 0.5rem;
    border-radius: 100px;
  }

  .topic-link.active .topic-count {
    background: rgba(255, 255, 255, 0.2);
    color: white;
  }

  /* Main Content */
  .answers-header {
    margin-bottom: 1.5rem;
  }

  .answers-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-dark);
  }

  .answer-count {
    font-weight: 400;
    color: #4b5563;
  }

  .answers-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .answer-card {
    display: block;
    padding: 1.75rem;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: 16px;
    text-decoration: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s
        ease;
  }

  .answer-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
    border-color: var(--color-primary);
  }

  .answer-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .answer-cluster {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .answer-reading-time {
    font-size: 0.75rem;
    color: #4b5563;
    background: #fafafa;
    padding: 0.25rem 0.625rem;
    border-radius: 100px;
  }

  .answer-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .answer-quick {
    font-size: 0.9375rem;
    color: #4b5563;
    line-height: 1.6;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .answer-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border);
  }

  .answer-date {
    font-size: 0.75rem;
    color: #4b5563;
  }

  .answer-cta {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-primary);
  }

  .answer-card:hover .answer-cta {
    gap: 0.5rem;
  }

  /* No Results */
  .no-results {
    text-align: center;
    padding: 3rem;
  }

  .no-results-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .no-results h3 {
    font-size: 1.25rem;
    color: var(--color-text-dark);
    margin-bottom: 0.5rem;
  }

  .no-results p {
    color: #4b5563;
  }

  /* Popular Section */
  .popular-section {
    padding: 5rem 0;
    background: #fafafa;
  }

  .section-header {
    text-align: center;
    margin-bottom: 2.5rem;
  }

  .section-title {
    font-size: clamp(1.75rem, 4vw, 2.25rem);
    line-height: 1.2;
    color: var(--color-text-dark);
  }

  .popular-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
    max-width: 900px;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .popular-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .popular-card {
    position: relative;
    padding: 2rem;
    background: white;
    border-radius: 16px;
    border: 1px solid var(--color-border);
    text-decoration: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .popular-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  }

  .popular-card-coming {
    opacity: 0.7;
    pointer-events: none;
  }

  .popular-number {
    display: block;
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--color-primary);
    opacity: 0.2;
    margin-bottom: 0.5rem;
  }

  .popular-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .popular-text {
    font-size: 0.9375rem;
    color: #4b5563;
    line-height: 1.5;
  }

  .coming-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--color-accent);
    background: rgba(255, 129, 88, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 100px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* CTA Section */
  .cta-section {
    padding: 5rem 0;
    background: linear-gradient(135deg, #0d3d1a 0%, #1a5c2e 100%);
    text-align: center;
  }

  .cta-content {
    max-width: 600px;
    margin: 0 auto;
  }

  .cta-title {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    color: white;
    margin-bottom: 1rem;
  }

  .cta-subtitle {
    font-size: 1.125rem;
    color: #b0b8b3;
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .cta-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }

  @media (min-width: 500px) {
    .cta-buttons {
      flex-direction: row;
      justify-content: center;
    }
  }

  .cta-section .btn-primary {
    background: white;
    color: var(--color-primary);
  }

  .cta-section .btn-primary:hover {
    background: rgba(255, 255, 255, 0.9);
  }

  .cta-section .btn-secondary {
    border-color: white;
    color: white;
  }

  .cta-section .btn-secondary:hover {
    background: white;
    color: var(--color-primary);
  }
</style>
